<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ihappy.store.infrastructure.repo.mybatis.mapper.weshop.WeshopCollectionJournalMapper">
  <resultMap id="BaseResultMap" type="com.ihappy.store.domain.dbdo.weshop.WeshopCollectionJournal">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 21 16:34:31 CST 2018.
    -->
    <id column="weshop_collection_journal_id" jdbcType="BIGINT" property="weshopCollectionJournalId" />
    <result column="visit_user_id" jdbcType="BIGINT" property="visitUserId" />
    <result column="visit_token" jdbcType="VARCHAR" property="visitToken" />
    <result column="store_id" jdbcType="BIGINT" property="storeId" />
    <result column="comp_id" jdbcType="INTEGER" property="compId" />
    <result column="collected_time" jdbcType="BIGINT" property="collectedTime" />
    <result column="created_at" jdbcType="BIGINT" property="createdAt" />
    <result column="updated_at" jdbcType="BIGINT" property="updatedAt" />
    <result column="created_person_id" jdbcType="INTEGER" property="createdPersonId" />
    <result column="updated_person_id" jdbcType="INTEGER" property="updatedPersonId" />
    <result column="is_deleted" jdbcType="BIT" property="isDeleted" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 21 16:34:31 CST 2018.
    -->
    weshop_collection_journal_id, visit_user_id, visit_token, store_id, comp_id, collected_time, 
    created_at, updated_at, created_person_id, updated_person_id, is_deleted
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 21 16:34:31 CST 2018.
    -->
    select 
    <include refid="Base_Column_List" />
    from weshop_collection_journal
    where weshop_collection_journal_id = #{weshopCollectionJournalId,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 21 16:34:31 CST 2018.
    -->
    delete from weshop_collection_journal
    where weshop_collection_journal_id = #{weshopCollectionJournalId,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.ihappy.store.domain.dbdo.weshop.WeshopCollectionJournal">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 21 16:34:31 CST 2018.
    -->
    insert into weshop_collection_journal (weshop_collection_journal_id, visit_user_id,
      visit_token, store_id, comp_id, 
      collected_time, created_at, updated_at, 
      created_person_id, updated_person_id, is_deleted
      )
    values (#{weshopCollectionJournalId,jdbcType=BIGINT}, #{visitUserId,jdbcType=BIGINT}, 
      #{visitToken,jdbcType=VARCHAR}, #{storeId,jdbcType=BIGINT}, #{compId,jdbcType=INTEGER}, 
      #{collectedTime,jdbcType=BIGINT}, #{createdAt,jdbcType=BIGINT}, #{updatedAt,jdbcType=BIGINT}, 
      #{createdPersonId,jdbcType=INTEGER}, #{updatedPersonId,jdbcType=INTEGER}, #{isDeleted,jdbcType=BIT}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.ihappy.store.domain.dbdo.weshop.WeshopCollectionJournal">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 21 16:34:31 CST 2018.
    -->
    insert into weshop_collection_journal
    <trim prefix="(" suffix=")" suffixOverrides=",">

        weshop_collection_journal_id,
        visit_user_id,

      <if test="visitToken != null">
        visit_token,
      </if>
      <if test="storeId != null">
        store_id,
      </if>
      <if test="compId != null">
        comp_id,
      </if>
      <if test="collectedTime != null">
        collected_time,
      </if>
      <if test="createdAt != null">
        created_at,
      </if>
      <if test="updatedAt != null">
        updated_at,
      </if>
      <if test="createdPersonId != null">
        created_person_id,
      </if>
      <if test="updatedPersonId != null">
        updated_person_id,
      </if>
      <if test="isDeleted != null">
        is_deleted,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
        #{weshopCollectionJournalId,jdbcType=BIGINT},
        #{visitUserId,jdbcType=BIGINT},
      <if test="visitToken != null">
        #{visitToken,jdbcType=VARCHAR},
      </if>
      <if test="storeId != null">
        #{storeId,jdbcType=BIGINT},
      </if>
      <if test="compId != null">
        #{compId,jdbcType=INTEGER},
      </if>
      <if test="collectedTime != null">
        #{collectedTime,jdbcType=BIGINT},
      </if>
      <if test="createdAt != null">
        #{createdAt,jdbcType=BIGINT},
      </if>
      <if test="updatedAt != null">
        #{updatedAt,jdbcType=BIGINT},
      </if>
      <if test="createdPersonId != null">
        #{createdPersonId,jdbcType=INTEGER},
      </if>
      <if test="updatedPersonId != null">
        #{updatedPersonId,jdbcType=INTEGER},
      </if>
      <if test="isDeleted != null">
        #{isDeleted,jdbcType=BIT},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.ihappy.store.domain.dbdo.weshop.WeshopCollectionJournal">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 21 16:34:31 CST 2018.
    -->
    update weshop_collection_journal
    <set>
      <if test="visitUserId != null">
        visit_user_id = #{visitUserId,jdbcType=BIGINT},
      </if>
      <if test="visitToken != null">
        visit_token = #{visitToken,jdbcType=VARCHAR},
      </if>
      <if test="storeId != null">
        store_id = #{storeId,jdbcType=BIGINT},
      </if>
      <if test="compId != null">
        comp_id = #{compId,jdbcType=INTEGER},
      </if>
      <if test="collectedTime != null">
        collected_time = #{collectedTime,jdbcType=BIGINT},
      </if>
      <if test="createdAt != null">
        created_at = #{createdAt,jdbcType=BIGINT},
      </if>
      <if test="updatedAt != null">
        updated_at = #{updatedAt,jdbcType=BIGINT},
      </if>
      <if test="createdPersonId != null">
        created_person_id = #{createdPersonId,jdbcType=INTEGER},
      </if>
      <if test="updatedPersonId != null">
        updated_person_id = #{updatedPersonId,jdbcType=INTEGER},
      </if>
      <if test="isDeleted != null">
        is_deleted = #{isDeleted,jdbcType=BIT},
      </if>
    </set>
    where weshop_collection_journal_id = #{weshopCollectionJournalId,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.ihappy.store.domain.dbdo.weshop.WeshopCollectionJournal">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 21 16:34:31 CST 2018.
    -->
    update weshop_collection_journal
    set visit_user_id = #{visitUserId,jdbcType=BIGINT},
      visit_token = #{visitToken,jdbcType=VARCHAR},
      store_id = #{storeId,jdbcType=BIGINT},
      comp_id = #{compId,jdbcType=INTEGER},
      collected_time = #{collectedTime,jdbcType=BIGINT},
      created_at = #{createdAt,jdbcType=BIGINT},
      updated_at = #{updatedAt,jdbcType=BIGINT},
      created_person_id = #{createdPersonId,jdbcType=INTEGER},
      updated_person_id = #{updatedPersonId,jdbcType=INTEGER},
      is_deleted = #{isDeleted,jdbcType=BIT}
    where weshop_collection_journal_id = #{weshopCollectionJournalId,jdbcType=BIGINT}
  </update>

  <select id="queryWeshopCollectionCountTimeRange" parameterType="java.util.Map" resultType="java.lang.Integer">
    select count(0) from (
    select
    visit_user_id,
    store_id
    from weshop_collection_journal
    where comp_id = #{compId,jdbcType=BIGINT}
        and store_id = #{storeId,jdbcType=BIGINT}
    <if test="collectedTimeFloor != null">
      <![CDATA[
          and collected_time >= #{collectedTimeFloor,jdbcType=BIGINT}
          ]]>
    </if>
    <if test="collectedTimeUpper != null">
      <![CDATA[
          and collected_time  <=  #{collectedTimeUpper,jdbcType=BIGINT}
           ]]>
    </if>
    group by visit_user_id,store_id
    ) t
  </select>

</mapper>